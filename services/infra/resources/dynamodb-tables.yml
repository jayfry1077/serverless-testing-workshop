Resources:
    # Main table for storing the core entities in the app (uses single table overloaded index design)
    MainTable:
        Type: AWS::DynamoDB::Table
        DeletionPolicy: ${self:custom.deletionPolicy.${self:provider.stage}}
        UpdateReplacePolicy: Retain
        Properties:
            TableName: ${self:custom.dynamoDbTablePrefix}-main
            StreamSpecification:
                StreamViewType: NEW_AND_OLD_IMAGES
            BillingMode: PAY_PER_REQUEST
            AttributeDefinitions:
            -   AttributeName: pk
                AttributeType: S
            -   AttributeName: sk
                AttributeType: S
            -   AttributeName: gs1pk
                AttributeType: S
            -   AttributeName: gs1sk
                AttributeType: S
            -   AttributeName: gs2pk
                AttributeType: S
            -   AttributeName: gs2sk
                AttributeType: S
            KeySchema:
            -   AttributeName: pk
                KeyType: HASH
            -   AttributeName: sk
                KeyType: RANGE
            GlobalSecondaryIndexes:
            -   IndexName: InvertedIndex
                KeySchema:
                -   AttributeName: sk
                    KeyType: HASH
                -   AttributeName: pk
                    KeyType: RANGE
                Projection:
                    ProjectionType: ALL
            -   IndexName: gs1
                KeySchema:
                -   AttributeName: gs1pk
                    KeyType: HASH
                -   AttributeName: gs1sk
                    KeyType: RANGE
                Projection:
                    ProjectionType: ALL
            -   IndexName: gs2
                KeySchema:
                -   AttributeName: gs2pk
                    KeyType: HASH
                -   AttributeName: gs2sk
                    KeyType: RANGE
                Projection:
                    ProjectionType: ALL

Outputs:
    DDBTableMain:
        Value: !Ref MainTable
